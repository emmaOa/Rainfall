/* Vulnerability Analysis for level4 */
// The program uses a format string vulnerability in the function p()
// A global variable at address 0x8049810 is checked against the value 0x1025544
// If the values match, the program prints the token for the next level
// Exploit: Use the format string bug to write the value 0x1025544 to the address 0x8049810

#include <stdio.h>

int global_var; // Located at address 0x8049810

void p(char *str) {
    printf(str); // VULNERABLE: Format string bug
}

void n() {
    char buffer[512];
    fgets(buffer, 512, stdin);
    p(buffer);
    if(global_var == 0x1025544) { // Win condition
        // Print the token directly
        system("cat /home/user/level5/.pass");
    }
}